@using CRReservation.COMMON.Services

@inherits LayoutComponentBase
@inject UserStateService UserStateService
@inject NavigationManager Navigation

@if (UserStateService.CurrentState.IsLoggedIn == false && !IsPublicPage())
{
    <RedirectToLogin />
}
else
{
    <div class="page">
        <div class="sidebar">
            <NavMenu />
        </div>

        <main>
            <article class="content px-4">
                @Body
            </article>
        </main>
    </div>
}

@code {
    private bool IsPublicPage()
    {
        string currentUri = Navigation.ToBaseRelativePath(Navigation.Uri).ToLowerInvariant();

        return currentUri == "login" || currentUri == ""; 
    }

    protected override void OnInitialized()
    {
        UserStateService.OnChange += StateHasChanged;
    }

    public void Dispose()
    {
        UserStateService.OnChange -= StateHasChanged;
    }
}