@page "/admin/reservations"
@using CRReservation.COMMON.Models
@using CRReservation.COMMON.Enums
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize(Roles = "Administrator")]
@inject NavigationManager NavigationManager

<h3>Zarządzanie Rezerwacjami</h3>

<div class="card mb-4">
    <div class="card-header">Filtruj</div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-4">
                <label class="form-label">Data</label>
                <input type="date" class="form-control" @bind="FilterDate" />
            </div>
            <div class="col-md-4 d-flex align-items-end">
                <button class="btn btn-primary" @onclick="FilterReservations">Pokaż</button>
            </div>
        </div>
    </div>
</div>

<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Sala</th>
                <th>Użytkownik</th>
                <th>Data Od</th>
                <th>Data Do</th>
                <th>Status</th>
                <th>Akcje</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var reservation in FilteredReservations)
            {
                    <tr>
                        <td>@reservation.Id</td>
                        <td>@reservation.ClassRoomName</td>
                        <td>@reservation.ReservedBy</td>
                        <td>@reservation.StartDateTime.ToShortDateString() @reservation.StartDateTime.ToShortTimeString()</td>
                        <td>@reservation.EndDateTime.ToShortDateString() @reservation.EndDateTime.ToShortTimeString()</td>
                        <td>
                        @switch (reservation.Status?.ToLower())
                        {
                            case "oczekujaca":
                                            <span class="badge bg-warning text-dark">Oczekująca</span>
                                break;
                            case "potwierdzona":
                                            <span class="badge bg-success">Zatwierdzona</span>
                                break;
                            case "odrzucona":
                                            <span class="badge bg-danger">Odrzucona</span>
                                break;
                            case "anulowana":
                                            <span class="badge bg-secondary">Anulowana</span>
                                break;
                            default:
                                            <span class="badge bg-light text-dark">@reservation.Status</span>
                                break;
                        }
                        </td>
                        <td>
                        @if (reservation.Status?.ToLower() == "oczekujaca")
                        {
                                    <button class="btn btn-success btn-sm me-2" disabled>Zatwierdź</button>
                        }
                        @if (reservation.Status?.ToLower() == "potwierdzona" || reservation.Status?.ToLower() == "oczekujaca")
                        {
                                    <button class="btn btn-danger btn-sm" disabled>Anuluj</button>
                        }
                        </td>
                    </tr>
            }
        </tbody>
    </table>
</div>

@code {
    private DateTime FilterDate { get; set; } = DateTime.Today;
    private List<Reservation> AllReservations = new();
    private List<Reservation> FilteredReservations = new();

    protected override void OnInitialized()
    {
        // TODO: Pobierz rezerwacje z API
        FilterReservations();
    }

    private void FilterReservations()
    {
        // Filter by selected date (ignoring time for the filter comparison)
        FilteredReservations = AllReservations
            .Where(r => r.StartDateTime.Date == FilterDate.Date)
            .ToList();
    }
}

